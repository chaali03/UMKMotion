---
import Layout from '../../layouts/HomepageLayout.astro';
import ProductDetailPage from '../../../components/ProductDetail/ProductDetailPage.tsx';

export const prerender = false;

const { asin } = Astro.params;
---

<Layout title={`Detail Produk - UMKMotion`} description="Detail produk lengkap dengan variant, rating, dan ulasan">
  <script>
    // Redirect semua /product/:asin ke /BuyingPage agar konsisten
    (function() {
      try {
        const asin = window.PRODUCT_ASIN || (typeof Astro !== 'undefined' && Astro?.params?.asin);
        if (asin) {
          // Seed minimal data untuk BuyingPage (hanya ASIN cukup, detail akan diambil kembali)
          const existing = localStorage.getItem('selectedProduct');
          let payload = { ASIN: asin };
          try {
            const parsed = existing ? JSON.parse(existing) : null;
            if (parsed && typeof parsed === 'object') payload = { ...parsed, ASIN: asin };
          } catch {}
          localStorage.setItem('selectedProduct', JSON.stringify(payload));
        }
      } catch {}
      window.location.replace('/BuyingPage');
    })();
  </script>
  <script define:vars={{
    FIREBASE_API_KEY: import.meta.env.PUBLIC_FIREBASE_API_KEY || import.meta.env.FIREBASE_API_KEY,
    FIREBASE_AUTH_DOMAIN: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN || import.meta.env.FIREBASE_AUTH_DOMAIN,
    FIREBASE_PROJECT_ID: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID || import.meta.env.FIREBASE_PROJECT_ID,
    FIREBASE_STORAGE_BUCKET: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET || import.meta.env.FIREBASE_STORAGE_BUCKET,
    FIREBASE_MESSAGING_SENDER_ID: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID || import.meta.env.FIREBASE_MESSAGING_SENDER_ID,
    FIREBASE_APP_ID: import.meta.env.PUBLIC_FIREBASE_APP_ID || import.meta.env.FIREBASE_APP_ID,
    FIREBASE_MEASUREMENT_ID: import.meta.env.PUBLIC_FIREBASE_MEASUREMENT_ID || import.meta.env.FIREBASE_MEASUREMENT_ID,
    productASIN: asin
  }}>
    window.ENV = {
      FIREBASE_API_KEY,
      FIREBASE_AUTH_DOMAIN,
      FIREBASE_PROJECT_ID,
      FIREBASE_STORAGE_BUCKET,
      FIREBASE_MESSAGING_SENDER_ID,
      FIREBASE_APP_ID,
      FIREBASE_MEASUREMENT_ID
    };
    window.PRODUCT_ASIN = productASIN;
  </script>

  <!-- Redirect page: tidak perlu render konten -->
</LandingPageLayout>

