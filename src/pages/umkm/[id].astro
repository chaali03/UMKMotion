---
import Layout from '../../layouts/LandingPageLayout.astro';
import UMKMDetailPage from '../../../Home/UMKMDetailPage/UMKMDetailPage.tsx';
import CommentSection from '../../components/ProductDetail/CommentSection.tsx';
import ProductRecommendations from '../../components/ProductDetail/ProductRecommendations.tsx';
import AnotherProduct from '../../components/ProductDetail/AnotherProduct.tsx';

export const prerender = false;

const { id } = Astro.params;
---

<Layout title={`Detail UMKM - UMKMotion`} description="Detail informasi UMKM dan produk">
  <script define:vars={{
    FIREBASE_API_KEY: import.meta.env.PUBLIC_FIREBASE_API_KEY || import.meta.env.FIREBASE_API_KEY,
    FIREBASE_AUTH_DOMAIN: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN || import.meta.env.FIREBASE_AUTH_DOMAIN,
    FIREBASE_PROJECT_ID: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID || import.meta.env.FIREBASE_PROJECT_ID,
    FIREBASE_STORAGE_BUCKET: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET || import.meta.env.FIREBASE_STORAGE_BUCKET,
    FIREBASE_MESSAGING_SENDER_ID: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID || import.meta.env.FIREBASE_MESSAGING_SENDER_ID,
    FIREBASE_APP_ID: import.meta.env.PUBLIC_FIREBASE_APP_ID || import.meta.env.FIREBASE_APP_ID,
    FIREBASE_MEASUREMENT_ID: import.meta.env.PUBLIC_FIREBASE_MEASUREMENT_ID || import.meta.env.FIREBASE_MEASUREMENT_ID,
    umkmId: id
  }}>
    window.ENV = {
      FIREBASE_API_KEY,
      FIREBASE_AUTH_DOMAIN,
      FIREBASE_PROJECT_ID,
      FIREBASE_STORAGE_BUCKET,
      FIREBASE_MESSAGING_SENDER_ID,
      FIREBASE_APP_ID,
      FIREBASE_MEASUREMENT_ID
    };
    window.UMKM_ID = umkmId;
  </script>

  <style>
    :global(body) {
      background: #f8fafc;
    }
    .container {
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 16px;
    }
  </style>

  <main class="min-h-screen bg-slate-50">
    <!-- DETAIL UMKM -->
    <section class="container" id="umkm-detail">
      <UMKMDetailPage client:load />
    </section>

    <!-- REKOMENDASI PRODUK TERKAIT -->
    <section class="container" id="recommendations" style="margin-top: 64px;">
      <ProductRecommendations client:load />
    </section>

    <!-- ULASAN / KOMENTAR -->
    <section class="container" id="comment-section" style="margin-top: 48px;">
      <CommentSection client:load />
    </section>

    <!-- PRODUK LAIN -->
    <section class="container" id="another-products" style="margin-top: 80px;">
      <AnotherProduct client:load />
    </section>
  </main>

  <script>
    window.addEventListener('storage', (e) => {
      if (e.key === 'selectedProduct') {
        window.location.reload();
      }
    });
  </script>
</Layout>
