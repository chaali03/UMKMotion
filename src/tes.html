<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fetch Produk — Cek Firestore</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --muted: #94a3b8;
      --accent: #06b6d4;
      --accent-2: #60a5fa;
      --white: #e6eef6;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #071022 0%, #081226 100%);
      color: var(--white);
      padding: 28px;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    header {
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:18px;
    }
    h1 { margin:0; font-size:20px; letter-spacing: -0.2px; }
    p.lead { margin:0; color:var(--muted); font-size:13px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      margin-bottom:18px;
    }
    .controls { display:flex; gap:8px; align-items:center; }
    button {
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#042027;
      border: none;
      padding:8px 12px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
    }
    button.secondary {
      background: transparent;
      color: var(--white);
      border: 1px solid rgba(255,255,255,0.06);
    }
    #status { color:var(--muted); margin-left:8px; font-size:13px; }
    table {
      width:100%;
      border-collapse: collapse;
      margin-top:12px;
    }
    thead th {
      text-align:left;
      padding:10px 12px;
      font-size:13px;
      color:var(--muted);
      border-bottom:1px solid rgba(255,255,255,0.04);
    }
    tbody td {
      padding:10px 12px;
      font-size:14px;
      border-bottom:1px dashed rgba(255,255,255,0.02);
    }
    img.thumb {
      width:64px;
      height:64px;
      object-fit:cover;
      border-radius:8px;
      box-shadow: 0 4px 12px rgba(2,6,23,0.6);
    }
    .small { font-size:12px; color:var(--muted); }
    .center { text-align:center; }
    .empty {
      padding:28px;
      text-align:center;
      color:var(--muted);
    }
    @media (max-width:900px){
      img.thumb{width:48px;height:48px;}
      thead th:nth-child(5), tbody td:nth-child(5) { display:none; } /* hide foto on small */
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Fetch Produk — Cek Firestore</h1>
        <p class="lead">Fetch & tampilkan isi koleksi <strong>products</strong> dari Firestore (native JS).</p>
      </div>
    </header>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div class="controls">
          <button id="btnLoad">Load Products</button>
          <button id="btnClear" class="secondary">Clear Table</button>
          <span id="status">Ready</span>
        </div>
        <div class="small">Hint: ganti <code>firebaseConfig</code> di bawah sebelum dipakai.</div>
      </div>

      <div id="tableWrap" style="margin-top:12px;">
        <table id="productsTable" aria-label="Products table">
          <thead>
            <tr>
              <th class="center">ID</th>
              <th>Judul</th>
              <th>ASIN</th>
              <th>Harga</th>
              <th>Foto</th>
              <th class="center">Stok</th>
              <th class="center">Terlaris</th>
            </tr>
          </thead>
          <tbody id="productsBody">
            <tr><td colspan="7" class="empty">Klik "Load Products" untuk memuat data dari Firestore.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Firebase v9 modular -->
  <script type="module">
    // === PASANG FIREBASE CONFIG DI SINI ===
    // Ganti dengan config web app milikmu (apiKey, authDomain, projectId, dsb).
const firebaseConfig = {
  apiKey: "AIzaSyAb8ETVtNgh1hHhO_6D8Oj5ElNIMMixCuc",
  authDomain: "umkmotion-a39b9.firebaseapp.com",
  projectId: "umkmotion-a39b9",
  storageBucket: "umkmotion-a39b9.firebasestorage.app",
  messagingSenderId: "437792595769",
  appId: "1:437792595769:web:ce18f9d1cc7bba5e7d12e8",
  measurementId: "G-WVB076CR9M"
};

    // Imports modular SDK dari CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // Init firebase + firestore
    let app, db;
    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    } catch (err) {
      console.error("Gagal init Firebase:", err);
      document.getElementById("status").textContent = "Firebase init error (cek config)";
    }

    const btnLoad = document.getElementById("btnLoad");
    const btnClear = document.getElementById("btnClear");
    const statusEl = document.getElementById("status");
    const body = document.getElementById("productsBody");

    function setStatus(t) { statusEl.textContent = t; }

    // Ambil produk dari koleksi 'products'
    async function fetchProducts() {
      if (!db) {
        setStatus("Firestore belum terhubung — masukkan config.");
        return;
      }
      setStatus("Loading...");
      body.innerHTML = `<tr><td colspan="7" class="empty">Memuat...</td></tr>`;

      try {
        const col = collection(db, "products");
        const snapshot = await getDocs(col);

        if (snapshot.empty) {
          body.innerHTML = `<tr><td colspan="7" class="empty">Koleksi kosong.</td></tr>`;
          setStatus("Selesai (0)");
          return;
        }

        // Map ke array yang mudah dipakai
        const items = snapshot.docs.map(d => {
          const data = d.data();
          return {
            id: d.id,
            asin: data.asin ?? "",
            judul_produk: data.judul_produk ?? data.nama ?? "(no title)",
            harga_produk: data.harga_produk ?? data.harga ?? "-",
            jumlah_unit: data.jumlah_unit ?? data.stok ?? null,
            foto_produk: data.foto_produk ?? data.product_photo ?? "",
            produk_terlaris: data.produk_terlaris ?? false,
          };
        });

        // render tabel
        body.innerHTML = items.map(it => `
          <tr>
            <td class="center">${escapeHtml(it.id)}</td>
            <td>
              <div style="font-weight:600">${escapeHtml(it.judul_produk)}</div>
              <div class="small">Harga: ${escapeHtml(it.harga_produk)}</div>
            </td>
            <td>${escapeHtml(it.asin)}</td>
            <td>${escapeHtml(it.harga_produk)}</td>
            <td><img class="thumb" src="${escapeAttr(it.foto_produk)}" alt="foto ${escapeHtml(it.judul_produk)}" onerror="this.style.opacity=0.5;this.style.filter='grayscale(1)';this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2264%22 height=%2264%22><rect width=%2264%22 height=%2264%22 fill=%22%238a98a6%22/></svg>'"></td>
            <td class="center">${it.jumlah_unit ?? "-"}</td>
            <td class="center">${it.produk_terlaris ? "✅" : ""}</td>
          </tr>
        `).join("");

        setStatus(`Selesai (${items.length})`);
      } catch (err) {
        console.error(err);
        body.innerHTML = `<tr><td colspan="7" class="empty">Error saat memuat data — cek console.</td></tr>`;
        setStatus("Error");
      }
    }

    btnLoad.addEventListener("click", fetchProducts);
    btnClear.addEventListener("click", () => {
      body.innerHTML = `<tr><td colspan="7" class="empty">Tabel dibersihkan.</td></tr>`;
      setStatus("Ready");
    });

    // small helpers to avoid XSS when injecting strings
    function escapeHtml(s) {
      if (!s && s !== 0) return "";
      return String(s)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }
    function escapeAttr(s) {
      if (!s && s !== 0) return "";
      return String(s)
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;")
        .replace(/</g, "%3C")
        .replace(/>/g, "%3E");
    }

    // optional: auto-load on open (comment/uncomment)
    // fetchProducts();
  </script>
</body>
</html>
